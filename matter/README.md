# Matter Server Setup

## Overview
This directory contains the Matter server configuration for your smart home setup. The Matter server provides a local Matter protocol implementation for discovering and controlling Matter-compatible devices.

## What is Matter?
Matter is a unified, open-source smart home standard that enables devices from different manufacturers to work together seamlessly. It provides:
- **Local Control**: Devices work without cloud connectivity
- **Interoperability**: Devices from different brands work together
- **Security**: End-to-end encryption for device communication
- **Reliability**: Local network communication for faster response

## Container Configuration

### Ports
- **5580**: Matter server WebSocket API
- **5581**: Matter commissioning port

### Volumes
- `./config:/data` - Matter server configuration and storage
- `/etc/localtime:/etc/localtime:ro` - Time synchronization
- `/run/dbus:/run/dbus:ro` - D-Bus communication for Bluetooth

### Environment Variables
- `TZ=Asia/Kuwait` - Timezone configuration

## Matter Server Features
- **Device Discovery**: Automatically discovers Matter devices on your network
- **Device Commissioning**: Add new Matter devices to your network
- **Device Control**: Control Matter devices through the API
- **Fabric Management**: Manage Matter fabrics and credentials
- **PAA Certificates**: Automatically fetches and manages Product Attestation Authority certificates
- **Vendor Database**: Maintains a database of Matter device vendors

## Server Status
The Matter server logs show:
- ✅ CHIP Controller Stack initialized
- ✅ 73 PAA root certificates loaded
- ✅ 353 vendors loaded from DCL (Distributed Compliance Ledger)
- ✅ Matter Server successfully initialized
- ✅ WebSocket API listening on port 5580

## Integration with Home Assistant
To integrate the Matter server with Home Assistant:

1. **Open Home Assistant** at `http://localhost:8123`
2. **Go to Settings > Devices & Services**
3. **Click "Add Integration"**
4. **Search for "Matter"**
5. **Enter Matter server URL**: `ws://matter-server:5580/ws`
6. **Home Assistant will connect** to the Matter server

## Adding Matter Devices

### Prerequisites
- Matter-compatible device (check device packaging for Matter logo)
- Device in pairing mode
- QR code or setup code from device

### Steps to Add Device
1. **In Home Assistant**, go to Settings > Devices & Services > Matter
2. **Click "Add Device"**
3. **Scan QR code** or enter setup code
4. **Follow commissioning process**
5. **Device will appear** in Home Assistant

## Supported Matter Device Types
- **Lights**: Bulbs, light strips, switches
- **Plugs**: Smart plugs and outlets
- **Sensors**: Motion, contact, temperature, humidity
- **Locks**: Smart locks and door locks
- **Thermostats**: Smart thermostats
- **Cameras**: Matter-compatible cameras
- **Switches**: Wall switches and buttons
- **Shades**: Window shades and blinds

## Troubleshooting

### Matter Server Not Starting
```bash
# Check logs
docker logs matter-server

# Restart container
docker-compose restart matter
```

### Device Discovery Issues
- Ensure devices are on the same network
- Check that devices are in pairing mode
- Verify Matter server can reach your network
- Check firewall settings

### Network Connectivity
```bash
# Test Matter server API
curl http://localhost:5580

# Check container network
docker network inspect myideas_matter
```

## Directory Structure
```
matter/
├── Dockerfile          # Matter server container definition
├── README.md          # This file
└── config/            # Matter server data directory
    ├── chip.json      # Matter device storage
    ├── chip_config.ini # CHIP stack configuration
    └── matter.yaml    # Matter server configuration
```

## Configuration Files

### matter.yaml
Contains Matter server configuration including:
- Server host and port settings
- Device discovery settings
- Commissioning configuration
- Logging and storage settings

### chip.json
Stores Matter device information, fabrics, and credentials. This file is automatically generated and managed by the Matter server.

## Security Notes
- Matter uses end-to-end encryption for all device communication
- Credentials are stored securely in the chip.json file
- The Matter server runs in a privileged container for Bluetooth access
- Network traffic is isolated using Docker networks

## Maintenance

### Backup Configuration
```bash
# Backup Matter server data
cp -r matter/config/ matter/config-backup-$(date +%Y%m%d)/
```

### Update Matter Server
```bash
# Rebuild with latest version
docker-compose build --no-cache matter
docker-compose up -d matter
```

### Reset Matter Server
```bash
# Stop container
docker-compose stop matter

# Remove data (WARNING: This will unpair all devices)
rm -rf matter/config/chip.json

# Restart container
docker-compose up -d matter
```

## Useful Commands

### View Matter Server Logs
```bash
docker logs -f matter-server
```

### Restart Matter Server
```bash
docker-compose restart matter
```

### Check Matter Server Status
```bash
docker ps | grep matter
```

### Access Matter Server Shell
```bash
docker exec -it matter-server /bin/bash
```

## Resources
- [Matter Specification](https://csa-iot.org/all-solutions/matter/)
- [Python Matter Server](https://github.com/home-assistant-libs/python-matter-server)
- [Home Assistant Matter Integration](https://www.home-assistant.io/integrations/matter/)
- [Matter Device Compatibility](https://www.home-assistant.io/integrations/matter/#compatible-devices)

## Support
For issues or questions:
1. Check the Matter server logs
2. Review Home Assistant logs
3. Consult the Matter documentation
4. Check device manufacturer's Matter compatibility guide

